export const files = {

    vivian:{
        id:"file0",
        title: "Our Golden Age",
        pages:[
            '<b>(Torn pages from a children book)</b> <br>' +
            'A long time ago, the world was divided<br>' +
            'Kingdoms fought kingdoms<br>' +
            'Cities fought cities<br>'+
            'Neighbors fought neighbors.<br>' +
            'There were flags everywhere, but no safety. <br>'+
            'There were heroes everywhere, but no peace.<br>' +
            'Children learned the sounds of war before they learned how to read.<br>' +
            'Each land believed it was right.<br>' +
            'Each ruler believed they were chosen.<br>' +
            'Each army believed the next battle would be the last.<br>' +
            '<b>But it never was...</b><br>' +
            'This was called <b>The Age of Endless Conflict.</b>',

            'Then came <b>Arno Von Vivian</b><br>' +
            'Arno did not promise revenge.<br>' +
            'He did not promise domination.<br>' +
            'He promised something no ruler had ever fulfilled before:<br>' +
            '<b>“PEACE.”</b><br>' +
            'Many laughed. Many resisted.<br>' +
            'Some were afraid. Some were hopeful.<br>' +
            `<b>But Arno pressed on.</b><br>` +
            `Arno traveled across Allarssyn.<br>` +
            `Some lands joined him, hoping for peace.<br>` +
            `Others fought him, afraid to lose power.<br>` +
            `The wars did not end overnight.<br>` +
            `But wherever Arno went, <b>the fighting stopped after.</b><br>`,

            `Borders disappeared.<br>`+
            `Armies stood down.<br>`+
            `People learned to speak instead of strike each other.<br>`+
            `<b>Allarssyn</b> began to feel like one place.<br>`+
            `When the last banner fell, the one that divided us.<br>`+
            `The wars were over.<br>`+
            `Not paused.<br>`+
            `Not delayed.<br>`+
            `<b>ENDED</b><br>`+
            `Arno declared Allarssyn <b>united.</b><br>`+
            `No <b>kingdoms</b> above others.<br>`+
            `No <b>blood</b> is superior to another.<br>`+
            `<b>People slept without fear of tomorrow.</b><br>`,

            `With the fighting gone, the world could finally breathe.<br>`+
            `Roads were built instead of walls.<br>`+
            `Cities connected instead of isolated.<br>`+
            `Knowledge flowed freely.<br>`+
            `Children grew up without learning how to hold weapons.<br>`+
            `<b>Peace became normal.</b><br>`+
            `Arno von Vivian gave the world a single future.<br>`+
            `And that future is the peace we live in now.<br>`+
            `<b>OUR GOLDEN AGE.</b><br>`+
            `<br><b><i>END OF LESSON</i></b><br>`
            ]
        },




    beast:{
        id:"file1",
        title: "THE BEAST",
        pages:[
            '<b>AUTHOR:</b> Louis Wills<br>' +
            '<b>SUBJECT:</b> The Structure of Existence<br><br>' +

            'For the sake of clarity, I will refer to it as <b>“The Beast.”</b><br>' +
            'This is not its true name.<br>' +
            'It may not have one.<br><br>' +

            'The Beast is not a creature in the conventional sense.<br>' +
            'It does not hunt. It does not judge.<br>' +
            'It does seem aware of us as individuals. That is… troubling.<br><br>' +

            'The Beast is better understood as a <b>system</b>.<br>' +
            'A living architecture of thought, memory, and possibility.<br>' +
            'A universe that behaves less like a machine…<br>' +
            'And more like a <b>mind</b>.<br><br>' +

            'Every world, every reality, every life exists <i>within</i> it.<br>' +
            'Not as a resident.<br>' +
            'But as a thought.'
            ,

            '<b>THREE STRATA OF EXISTENCE</b><br><br>' +

            'Through observation and repeated failure, I have identified three distinct layers within the Beast. For ease of communication, I have borrowed psychological terminology.<br><br>' +

            '<b>1. THE ULTRA EGO</b><br>' +
            'These are the <b>Worlds of Rule</b>.<br>' +
            'Places governed by consistency: gravity, causality, time, logic.<br>' +
            'Civilizations emerge here. Histories accumulate. Technology advances.<br><br>' +

            'Allarssyn is an Ultra Ego world.<br>' +
            'So was every world we ever mistook for being “alone.”<br><br>' +

            'Ultra Ego worlds are stable only as long as they are <b>remembered</b> by the system.'
            ,

            '<b>2. THE EGO (The In-Between)</b><br>' +
            'The Ego is not a place so much as a <b>transition</b>.<br>' +
            'It is mutable, symbolic, and deeply irrational.<br><br>' +

            'This is where myths breathe.<br>' +
            'Where dragons make sense.<br>' +
            'Where impossible geography feels natural.<br><br>' +

            'The Ego functions as a mediator between rigid worlds and the deeper system.<br>' +
            'It is accessed primarily through <b>dreams</b>.<br><br>' +

            'When a person dreams, their consciousness briefly disconnects from the Ultra Ego and drifts into the Ego.<br>' +
            'This connection is not optional.<br>' +
            'A world that cannot dream is a world that cannot persist.'
            ,

            '<b>THE BLACK PYRAMID</b><br><br>' +

            'Ancient records and recurring dream-symbols point to a central construct within the Ego: the <b>Black Pyramid</b>.<br>' +
            'It is believed to have functioned as a <b>Unified Ego</b>.<br>' +
            'A time where <b>ALL<> things were one.<br><br>' +

            'It also aligns with the Legends of the Pyramid being shattered.<br>' +
            'Which would explain our world and worlds like ours.<br><br>' +

            'Each Ultra Ego world may be nothing more than a host for the <b>Shards</b>.<br>' +
            'Which form a self-contained bubble of reality, floating just far enough apart to avoid collapse.',

            '<b>3. THE ID (The Void / The Unknown)</b><br>' +
            `The Id is not a place. It is not a thing in any sense we understand. It does not think. It does not intend. It simply occurs.<br>` +

            'Where the Ego changes form, the Id erases it.<br>' +
            'Where the Ego dreams, the Id consumes.<br><br>' +

            'Contact with the Id results in cognitive dissolution, loss of identity, or worse outcomes I am unwilling to document further...<br><br>' +

            `Studies / Contact, anything on the Id, is prohibited <br>` +
            'For the sake of all things <b>LEAVE. IT BE.</b>.<br>' +
            'As it leaves us be.'
            ,

            '<b>FINAL NOTE</b><br><br>' +

            'Once a world slips beyond the Ego,<br>' +
            'Once it loses the ability to dream,<br>' +
            'There is no known method of retrieval.<br><br>' +

            'We do not live <i>in</i> the universe.<br>' +
            'We live inside its attention.'
        ]
    },



projectv:{
    id:"file2",
    title:"[FILE 7]",
    pages:[
        '<b>SUBJECT:</b> PROJECT VIVIAN<br>' +
        '<b>AUTHOR:</b> Louis Wills, Chief Scientist<br><br>' +

        '<b>OVERVIEW:</b> Project Vivian was initiated as a long-term contingency program.<br>' +
        'Its purpose is <b>continuity</b>.<br>' +
        'In the event that Emperor Arno von Vivian succumbed to his illness, his body may fail, but his existence would not.<br><br>' +

        '<b>THE MATERIAL:</b> The defining breakthrough of Project VIVIAN was not the Pod itself, but the discovery of its construction medium.<br>' +
        'The material was first observed forming naturally in regions surrounding the <b>World Shard</b>. '+
        'Outside the Shard’s influence, the material exhibits absolute structural stability.<br>' +
        'It cannot be cut, fractured, melted, or altered through any known mechanical or energetic process.' ,

        'Proximity to the Shard produces the inverse effect.<br>' +
        'As distance decreases, the material progressively loses rigidity.<br>' +
        'Within close range, it becomes pliable, moldable, and responsive to applied force, comparable to soft composite clay.<br><br>' +

        'This state is temporary.<br>' +
        'Once removed from the Shard’s influence, the material irreversibly returns to its inert, stable form.<br>' +
        'All structural decisions become permanent at that moment.<br><br>' +

        '<b>THE POD:</b> Each VIVI Pod is a sealed cognitive environment.<br>' +
        'It is designed to host a living brain while replicating the sensory and regulatory feedback normally provided by a biological body.<br><br>' ,

        '<b>THE BACKUP PERSONALITY:</b> A secondary cognitive framework is embedded within the Pod.<br>' +
        'This framework functions as a fallback system in the event of host failure, instability, or loss of executive control.<br><br>' +
        'When activated, <b>VIVI</b> assumes operational autonomy and guides the Pod toward the nearest viable point of safety or recovery.<br><br>' +

        '<b>AUGMENTATION:</b> The Pod is equipped with autonomous defense and mobility systems.<br>' +
        'These include electromagnetic discharge capabilities and short-range propulsion.<br><br>' +
        'Such features were added to ensure a long-term independence from external protection.<br><br>'
    ]
},


quinn:{
    id:"file3",
    title:"Opened Letter",
    pages:[
        `<b>To Quinn,</b><br><br>

        I do not know if you will read this...<br>
        I only know that you will find it.<br><br>

        I have written many speeches in my life.<br>
        Declarations. Lessons meant for entire nations.<br>
        <b>None of them were as difficult as this.</b><br><br>

        I remember the first time I saw you.<br>
        You do not remember it the same way. You were too young. Too busy surviving.<br>
        You were watching hands, not faces. Watching exits. Measuring distance.<br>
        You had already learned the habits of a hunted thing.<br>
        That day frightened me, it was like looking in the mirror.<br>
        <b>The world had already failed you, like it failed me...</b><br><br>`,

        `I made choices...<br>
        Terrible ones. <b>Very Terrible ones</b>.<br>
        Choices that history will forgive, because history is written by the victors.<br>
        But forgiveness from the world has never mattered to me. <b>Only yours.</b><br><br>

        Everything I built, every action, every thought, was for one simple dream:<br>
        <b>That you would never have to do what I had done and still do.</b><br><br>

        A place where you would not have to kill.<br>
        Where you would not have to run.<br>
        Where you would not have to die.<br><br>


        <b>I have never stopped seeing you as my daughter.</b><br>
        Even when you looked at me like a stranger. Even when you tried to kill me.<br>
        Even now.<br><br>`,

        `If this letter has reached you, then I am still here.<br>
        Waiting.<br>
        Not as an emperor.<br>
        As a father.<br>

        <b>a father who wants one last chance to speak to his child.</b><br><br>

        <b>Please, Quinn.</b><br>

        Come see me. I don't think I have long.<br><br>

        Your loving father.
        — <b>Arno von Vivian</b>`
    ]
},
}



export let smootherInstance = null; 
const VIVICHARA = document.getElementById('secret-vivi');


export function setSmootherInstance(instance) {
    smootherInstance = instance;
}

let scrollPosition = 0;

export function lockScroll() {
  scrollPosition = window.pageYOffset;
  document.body.style.overflow = 'hidden';
  document.body.style.position = 'fixed';
  document.body.style.top = `-${scrollPosition}px`;
  document.body.style.width = '100%';
}

export function unlockScroll() {
  document.body.style.overflow = 'visible';
  document.body.style.position = '';
  document.body.style.top = '';
  document.body.style.width = '';
  window.scrollTo(0, scrollPosition);
}

export function hideLoader() {
    const loader = document.getElementById('loader-wrapper');
    if (loader) {
        gsap.to(loader, { 
            opacity: 0, 
            duration: 0.5, 
            ease: "power2.inOut",
            onComplete: () => {
                loader.style.visibility = 'hidden';
                loader.style.pointerEvents = 'none';
                unlockScroll();
            }
        });
    } else {unlockScroll();
    }


}


export function showStartButton() {
    const tl = gsap.timeline();

    tl
    .to("#loading-bar",{ backgroundColor:"#00ffff", repeat: -1, yoyo: true, duration: 1 })
    .to("#start-btn", { visibility: 'visible', opacity: 1, duration: 2,},"<")
    .to("#loading-text",{text:"Ready when you are." , duration: 2},"<")
    .to("#loading-title",{text:"./PROJECT VIVIAN" , duration: 2},"<")
}


export function killGSAP() {
    ScrollTrigger.killAll();
    gsap.set(".parallax-layer", { clearProps: "all" });
    if (smootherInstance) {
        smootherInstance.kill();
        smootherInstance = null;
    }
    ScrollTrigger.refresh();
}


// --- FULLSCREEN LOGIC ---
const fullscreenToggle = document.getElementById('fullscreenToggle');
if (fullscreenToggle) {fullscreenToggle.addEventListener('click', () => fullscreen());}
window.addEventListener('fullscreenchange', () => updateButtonText(fullscreenToggle));

export function fullscreen(){
    if (!document.fullscreenElement) {
        document.documentElement.requestFullscreen();
    } else {
        document.exitFullscreen();
    }
    updateButtonText(fullscreenToggle);
}

function updateButtonText(fullscreenToggle) {
    if (document.fullscreenElement) {
        fullscreenToggle.textContent = "Exit Fullscreen (F11)";
    } else {
        fullscreenToggle.textContent = "Go Fullscreen (F11)";
    }
}



const footstepSounds = ['f0', 'f1', 'f2', 'f3'];

export function playRandomStep() {
    const randomId = footstepSounds[Math.floor(Math.random() * footstepSounds.length)];
    const sound = document.getElementById(randomId);
    
    if (sound) {
        sound.currentTime = 0;
        sound.volume = 1.0;
        sound.play();
    }
}

const neonImg = document.querySelector('.project-vivian');
const neonImg2 = document.querySelector('.project-vivian2');
const volumeSlider = document.getElementById('volume-slider');
const cornerSlider = document.querySelector('#corner-volume-slider');

// 1. Setup the ONE and ONLY Audio Context
const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
const masterBus = audioCtx.createGain();
masterBus.connect(audioCtx.destination);

// Set initial volume (from session storage or default to 0.5)
const savedVolume = sessionStorage.getItem('userVolume') || 0.0;
masterBus.gain.value = savedVolume;
volumeSlider.value = savedVolume;
cornerSlider.value = savedVolume;
neonImg.style.setProperty('--intensity', savedVolume);
neonImg2.style.setProperty('--intensity', savedVolume);

// 2. Connect all audio tags (Only do this once!)
const audioElements = Array.from(document.querySelectorAll('audio'));
audioElements.forEach(el => {
    const source = audioCtx.createMediaElementSource(el);
    source.connect(masterBus);
});

// 3. Start Button Logic
const startBtn = document.getElementById('start-btn');
startBtn.addEventListener('click', async () => {
    hideLoader();
    
    // IMPORTANT: Resume the existing context
    if (audioCtx.state === "suspended") {
        await audioCtx.resume();
    }

    // Play your specific background tracks
    const toPlay = ["s0-bg", "s1-bg", "s2-bg", "trem", "ele"];
    toPlay.forEach(id => {
        const el = document.getElementById(id);
        el.play().catch(e => console.log("Playback blocked for:", id));
    });
});


// 4. Volume Slider Logic
function updateVolume(value) {
    // 1. Update the Audio Context
    masterBus.gain.value = value;
    
    // 2. Sync both slider UI positions
    volumeSlider.value = value;
    cornerSlider.value = value;
    
    // 3. Optional: Update your Neon Intensity variable from earlier
    if(neonImg) neonImg.style.setProperty('--intensity', value);
    if(neonImg2) neonImg2.style.setProperty('--intensity', value);
    if(VIVICHARA) VIVICHARA.style.filter = `brightness(${value})`;

    // 4. Save to session
    sessionStorage.setItem('userVolume', value);
}

// Listener for Dashboard Slider
volumeSlider.addEventListener('input', (e) => updateVolume(e.target.value));

// Listener for Corner Slider
cornerSlider.addEventListener('input', (e) => updateVolume(e.target.value));
// 5. Slider Feedback Sound


const feedbackSound = document.getElementById('vslider');
volumeSlider.addEventListener('mousedown', () => feedbackSound.play());
cornerSlider.addEventListener('mousedown', () => feedbackSound.play());
window.addEventListener('mouseup', () => feedbackSound.pause());







const allButtons = document.querySelectorAll('button');
const pressSFX = document.getElementById('press');
const pturn = document.getElementById('pturn');
allButtons.forEach(btn => {
    btn.addEventListener('mousedown', () => {
        if (!btn.classList.contains('ctrl-btn') && !btn.classList.contains('inv-tool-icon')) {pressSFX.play();}
    });
});


const desktopRatioQuery = "(min-aspect-ratio: 4/3)";
if (!window.matchMedia(desktopRatioQuery).matches) {updateVolume(1.0);}








const invIcon = document.querySelector('.inv-tool-icon');
const invWrapper = document.querySelector('.inv-wrapper');

// Create an overlay div in JS if it doesn't exist
const overlay = document.createElement('div');
overlay.id = 'inv-overlay';
document.body.appendChild(overlay);

// OPEN FUNCTION
function openInventory() {
    document.getElementById('bopen').play();
    lockScroll();
    invIcon.classList.add('unclickable');
    invIcon.classList.add('is-active');

    const tl = gsap.timeline();

    tl.to(invIcon, {
        left: "15vw",
        bottom: "-5vh",
        scale: 5.2,
        duration: 0.5,
        ease: "back.in(1.7)",
    })
    .to(invIcon, {
        opacity: 0,
        duration: 0.3
    }, "+=0.1")
    .to([invWrapper, overlay], {
        autoAlpha: 1, // Sets visibility: visible and opacity: 1
        duration: 0.5
    }, "-=0.1");
}

// CLOSE FUNCTION
function closeInventory() {
    document.getElementById('bclose').play();
    unlockScroll();
    const tl = gsap.timeline();

    tl.to([invWrapper, overlay], {
        autoAlpha: 0,
        duration: 0.3
    })
    .to(invIcon, {
        opacity: 1,
        scale: 1,
        left: "3vw",
        bottom: "1vw",
        duration: 0.5,
        onComplete: () => {
            invIcon.classList.remove('unclickable');
            invIcon.classList.remove('is-active');        
        }
    },"<");
}

// Event Listeners
invIcon.addEventListener('click', openInventory);
overlay.addEventListener('click', closeInventory); // Close when clicking outside






let currentItem = null;
let inventoryData = JSON.parse(sessionStorage.getItem('inv')) || [
    {
        title: files.quinn.title,
        pages: files.quinn.pages,
        id: files.quinn.id,
        currentPage: 0
    }
];
updateInv();

export function addItemToBackpack(fileObj, elementId) {
    if (elementId) {
        const el = document.getElementById(elementId);
        if (el) el.style.display = 'none';
    }

    // Create the new item
    const newItem = { 
        title: fileObj.title, 
        pages: fileObj.pages,
        id: fileObj.id,
        currentPage: 0 
    };

    inventoryData.push(newItem);
    
    sessionStorage.setItem('inv', JSON.stringify(inventoryData));
    
    triggerNotification('Collected ' + newItem.title);
    document.getElementById('file').play();
    updateInv();
}

function updateInv() {
    const listContainer = document.getElementById('inv-list-container');
    
    listContainer.innerHTML = ''; 

    inventoryData.forEach((item) => {
        const div = document.createElement('div');
        div.className = 'inv-list-item';
        div.innerHTML = `> ${item.title}`;
        div.onclick = () => displayItem(item);
        listContainer.appendChild(div);
        const itemElement = document.getElementById(item.id);
        console.log(item.id);
        if (itemElement)itemElement.style.display = 'none';
    });
}

function displayItem(item) {
    pturn.currentTime = 0;
    pturn.play();
    currentItem = item;
    const titleEl = document.getElementById('view-title');
    const bodyEl = document.getElementById('view-body');
    const pageEl = document.getElementById('page-num');

    titleEl.innerHTML = item.title;
    bodyEl.innerHTML = item.pages[item.currentPage];
    pageEl.innerHTML = `${item.currentPage + 1} / ${item.pages.length}`;
}

// Next/Prev Page Logic
document.getElementById('next-btn').onclick = () => {
    pturn.currentTime = 0;
    pturn.play();
    if (currentItem && currentItem.currentPage < currentItem.pages.length - 1) {
        currentItem.currentPage++;
        displayItem(currentItem);
    }
};

document.getElementById('prev-btn').onclick = () => {
    pturn.currentTime = 0;
    pturn.play();
    if (currentItem && currentItem.currentPage > 0) {
        currentItem.currentPage--;
        displayItem(currentItem);
    }
};







document.getElementById('file0').onclick = () => {addItemToBackpack(files.vivian,'file0');};
document.getElementById('file1').onclick = () => {addItemToBackpack(files.beast,'file1');};


const slider = document.getElementById('inv-list-container');
let isDown = false;
let startY;
let scrollTop;

slider.addEventListener('mousedown', (e) => {
    isDown = true;
    slider.classList.add('active-grab'); // Optional: change cursor to 'grabbing'
    startY = e.pageY - slider.offsetTop;
    scrollTop = slider.scrollTop;
});

slider.addEventListener('mouseleave', () => {isDown = false;});
slider.addEventListener('mouseup', () => {isDown = false;});

slider.addEventListener('mousemove', (e) => {
    if (!isDown) return;
    e.preventDefault();
    const y = e.pageY - slider.offsetTop;
    const walk = (y - startY) * 1.5; // The '2' is scroll speed multiplier
    slider.scrollTop = scrollTop - walk;
});




function triggerNotification(text) {
    const noti = document.querySelector('.noti');
    const notiText = noti.querySelector('p');
    notiText.innerHTML = text;
    
    noti.classList.add('active');
    
    setTimeout(() => {
        noti.classList.remove('active');
    }, 3000);
}

